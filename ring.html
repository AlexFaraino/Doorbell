<!DOCTYPE html>
<html>
<head>
<title>Fabelier Doorbell</title>
<script src="/socket.io/socket.io.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<img src="{{logo_url}}" style="float: left; padding-right: 50px" alt="logo">
<div id=content>
<h1>Fabelier door bell</h1>
<p>Please, ring here ...and wait, please :)</p>
<br/>
<div id="state" style="visibility: hidden;">Feedback...</div><br/>
<input id=bell type=button value="The bell" style="height: 100px; width: 200px;" >

</div>

<script>
window.onload = function() {

    var messages = [];
    var socket = io.connect('{{url}}');
    var bellButton = document.getElementById("bell");
    var state = document.getElementById("state");
    var currentlyRinging = false;
    
    //Reset state box
    state.value="";
    
    //Register as a visitor
    socket.emit('type', {type: 'visitor'});

    bellButton.onclick = function() {
        socket.emit('ring', { message: "Someone's here!" });
    };

    socket.on('message', function(data) {
        if(data.message) {
          currentlyRinging = false;
          state.innerHTML = data.message;
          state.style.visibility = "visible";
        } else {
          console.log("There is a problem: ", data);
        }
    });

    socket.on('ringing', function(data) {
        currentlyRinging = true;
        state.innerHTML = "== Ringing! ==";
        state.style.visibility = "visible";
        setTimeout(notRingingAnymore, 10000);
    });

    function notRingingAnymore(){
      if ( currentlyRinging ){
        currentlyRinging = false;
        state.innerHTML = "&nbsp";
        state.style.visibility = "hidden";
      }
    }
}

</script>
</body>
</html>
